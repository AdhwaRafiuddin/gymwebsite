<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gym Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background: linear-gradient(135deg, #798777, #6c7a6a); color: #F8EDE3; min-height: 100vh; }
.navbar { background-color: #A2B29F; box-shadow:0 3px 10px rgba(0,0,0,0.2);}
.navbar-brand { color: #F8EDE3 !important; font-weight:800; letter-spacing:1px; }
.card { background-color:#A2B29F; border:none; border-radius:18px; padding:20px; margin-bottom:22px; box-shadow:0 10px 25px rgba(0,0,0,0.25);}
.exercise-item { background-color:#B5C7B3; border-radius:12px; padding:12px 15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;}
.exercise-info { flex:1; font-weight:600; color:#2f3b2f; }
.exercise-info .name { font-weight:800; margin-right:6px; }
.btn-custom { background-color:#F8EDE3; color:#798777; font-weight:700; border-radius:16px; padding:12px 30px;}
.btn-custom:hover { background-color:#BDD2B6; }
.section-title { font-weight:800; }
.section-title.day-type { color:#2f3b2f; font-size:14px; text-transform:uppercase;}
.subtle-text { color:#DDE6DD; font-weight:500; }
</style>
</head>

<body>

<nav class="navbar navbar-dark px-3">
    <span class="navbar-brand">üèãÔ∏è Gym Tracker</span>
</nav>

<div class="container my-4">
    <div class="text-center mb-4">
        <h4 id="todayDate" class="fw-bold"></h4>
        <p class="subtle-text">Consistency builds strength.</p>
    </div>

    <div id="lastWorkoutContainer"></div>

    <div class="text-center mt-4">
        <a href="log.html" class="btn btn-custom">Log New Workout üí™</a>
    </div>
</div>

<!-- Firebase Setup -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAPy4J2VvWVbTjzKPGhr5YkfYwwL7Ai6B4",
  authDomain: "gymwebsite-tracker.firebaseapp.com",
  projectId: "gymwebsite-tracker",
  storageBucket: "gymwebsite-tracker.firebasestorage.app",
  messagingSenderId: "1048952192948",
  appId: "1:1048952192948:web:b77466f54c26e8f74c7ce1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// make accessible globally
window.db = db;
window.collection = collection;
window.getDocs = getDocs;

// Initialize app
initApp();
</script>

<script>
async function initApp() {
    // Show today's date
    const today = new Date();
    document.getElementById("todayDate").innerText =
        today.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

    // Load last workouts
    await loadWorkouts();
}

async function loadWorkouts() {
    const container = document.getElementById("lastWorkoutContainer");
    container.innerHTML = "";

    try {
        const querySnapshot = await window.getDocs(window.collection(window.db, "workouts"));
        const workouts = [];
        querySnapshot.forEach(doc => workouts.push(doc.data()));

        if (workouts.length === 0) {
            container.innerHTML = `
                <div class="card text-center">
                    <h5>No workouts logged yet üí§</h5>
                    <p>Start your journey by logging your first workout.</p>
                </div>
            `;
            return;
        }

        // Sort newest first
        workouts.sort((a,b) => new Date(b.date) - new Date(a.date));
        const latestWorkout = workouts[0];

        const card = document.createElement("div");
        card.classList.add("card");

        let html = `
    <h6 class="section-title day-type mb-1">${latestWorkout.dayType} Day</h6>
    <h5 class="section-title mb-3">
        ${latestWorkout.person} ‚Äì ${new Date(latestWorkout.date).toLocaleDateString()}
    </h5>
`;

        latestWorkout.exercises.forEach(ex => {
            html += `
                <div class="exercise-item">
                    <div class="exercise-info">
                        <span class="name">${ex.name}</span>
                        ${ex.sets} sets √ó ${ex.reps} reps @ ${ex.weight} kg
                    </div>
                </div>
            `;
        });

        card.innerHTML = html;
        container.appendChild(card);

    } catch (err) {
        console.error("Error loading workouts:", err);
        container.innerHTML = `<div class="card text-center"><h5>Error loading workouts.</h5></div>`;
    }
}
</script>

</body>
</html>
